<div class="title-bar">
  <h2 class="page-title">Detalle de Receta</h2>
</div>
<div class="main-page container-fluid">
  <div class="container-fluid">
    <form [formGroup]="formReceta" class="mb-3">
      <div class="row">
        <div class="col-12">
          <h5 class="mb-3">Datos Generales</h5>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-12">
          <label><strong>Título</strong></label>
          <input type="text" class="form-control" formControlName="titulo" placeholder="Título de la receta">
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-12">
          <label><strong>Preparación</strong></label>
          <textarea class="form-control" formControlName="preparacion" placeholder="Descripción de la preparación"></textarea>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-4">
          <label><strong>Apto vegetariano</strong></label>
          <input type="checkbox" formControlName="apto_vegetariano">
        </div>
        <div class="col-4">
          <label><strong>Apto vegano</strong></label>
          <input type="checkbox" formControlName="apto_vegano">
        </div>
      </div>

      <hr class="my-5">

      <div class="row">
        <div class="col-12">
          <h5 class="mb-3">Valores Energéticos</h5>
        </div>
      </div>

      <div class="row">
        <div class="col-3"><label><strong>Calorías (kcal)</strong></label><input type="number" class="form-control" formControlName="energia_total_kcal" readonly></div>
        <div class="col-3"><label><strong>Energía (kJ)</strong></label><input type="number" class="form-control" formControlName="energia_total_kj" readonly></div>
      </div>

      <hr class="my-5">

      <div class="row">
        <div class="col-12">
          <h5 class="mb-3">Macronutrientes</h5>
        </div>
      </div>

      <div class="row"> 
        <div class="col-3"><label><strong>Proteínas</strong></label><input type="number" class="form-control" formControlName="proteinas_totales" readonly></div>
        <div class="col-3"><label><strong>Carbohidratos</strong></label><input type="number" class="form-control" formControlName="carbohidratos_totales" readonly></div>
        <div class="col-3"><label><strong>Grasas</strong></label><input type="number" class="form-control" formControlName="grasas_totales" readonly></div>
      </div>

      <hr class="my-5">

      <div class="row">
        <div class="col-12">
          <h5 class="mb-0">Ingredientes</h5>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-12">
          <div formArrayName="ingredientes">
            <div *ngFor="let ingrediente of ingredientes.controls; let i = index" [formGroupName]="i">
              <div class="row mt-2">
                <div class="col-6"><input type="text" class="form-control" formControlName="alimento" placeholder="Alimento" readonly></div>
                <div class="col-2"><input type="text" class="form-control" formControlName="porcion" placeholder="Porcion" readonly></div>
                <div class="col-1"><input type="number" class="form-control" formControlName="cantidad" placeholder="Cantidad" readonly></div>
                <div class="col-1 ps-0"><button type="button" class="btn btn-danger" (click)="eliminarIngrediente(i)" [hidden]="soloLectura"><i class="fas fa-trash"></i></button></div>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-primary mt-3" (click)="abrirModalIngrediente()" [hidden]="soloLectura"><i class="fas fa-plus"></i> Agregar ingrediente</button>
        </div>
      </div>

      <div class="row mt-5">
        <div class="col-12 d-flex justify-content-between">
          <button class="btn btn-secondary" (click)="limpiarReceta()">Volver</button>
          <button *ngIf="!esNuevo && soloLectura" class="btn btn-primary" (click)="toggleSoloLectura()">Editar</button>
          <button *ngIf="esNuevo || !soloLectura" class="btn btn-primary" [disabled]="!formReceta.valid" (click)="guardarReceta()">Guardar</button>
        </div>
      </div>
    </form>
  </div>
</div>

<app-modal-ingrediente
  [(showDialog)]="mostrarModal"
  (ingredienteSeleccionado)="agregarIngredienteSeleccionado($event)">
</app-modal-ingrediente>
